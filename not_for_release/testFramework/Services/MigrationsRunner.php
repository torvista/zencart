<?php

namespace Tests\Services;

/**
 * @since ZC v2.0.0
 */
class MigrationsRunner
{
    public function __construct(protected $migrationDir)
    {
    }

    /**
     * @since ZC v2.0.0
     */
    public function run(): void
    {
        $files = glob($this->migrationDir . '*_migration.php');
        foreach ($files as $migration)
        {
            $className = 'Migrations\\Create' . ucfirst(self::camel(str_replace(['.php', 'migration'], '', basename($migration)))) . 'Table';
            $class =  new $className;
            $class->down();
            $class->up();
        }
    }

    /**
     * @since ZC v2.2.0
     */
    private static function camel(string $value): string
    {
        $value = preg_replace('/[^a-zA-Z0-9]+/', ' ', $value);
        $value = ucwords(strtolower(trim($value)));
        return str_replace(' ', '', $value);
    }
}
